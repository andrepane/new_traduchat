<!DOCTYPE html>
<html lang="es">
  <head>
    <meta name="google-site-verification" content="83jW8SKOcUfQI9McLQ0qGOFa6oaBo6N19c5m9mAHOyQ" />
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="theme-color" content="#00b451" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      name="description"
      content="Chat multiling√ºe con traducci√≥n autom√°tica"
    />
    <title>TraduChat</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.json" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="images/icon-192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="images/icon-512.png"
    />
    <link rel="apple-touch-icon" href="images/icon-192.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Pantalla de carga -->
    <div class="loading-screen">
      <div class="spinner"></div>
    </div>

    <!-- Pantalla de autenticaci√≥n -->
    <div id="authScreen" class="screen active">
      <div class="auth-container">
        <h1 id="titulo-wave" data-translate="appTitle">TraduChat</h1>

        <!-- Selector de idioma -->
        <div class="language-selector">
          <label data-translate="selectLanguage">Seleccionar idioma</label>
          <select id="languageSelect" class="language-select">
            <option value="es" data-translate="languageEs">Espa√±ol</option>
            <option value="en" data-translate="languageEn">Ingl√©s</option>
            <option value="it" data-translate="languageIt">Italiano</option>
          </select>
        </div>

        <!-- Selector de tema -->
        <div class="theme-selector">
          <label data-translate="selectTheme">Seleccionar tema</label>
          <select id="themeSelect" class="theme-select">
            <option value="banderas" data-translate="themeBanderas">
              Colores de bandera
            </option>
            <option value="elegante" data-translate="themeElegante">
              Pastel elegante
            </option>
            <option value="creativo" data-translate="themeCreativo">
              Creativo vibrante
            </option>
            <option value="elegante2" data-translate="themeElegante2">
              Brisa de t√©
            </option>
          </select>
        </div>

        <input
          type="email"
          id="emailInput"
          data-translate="email"
          placeholder="Correo electr√≥nico"
        />
        <input
          type="text"
          id="usernameInput"
          data-translate="username"
          placeholder="Nombre de usuario"
        />
        <div class="password-wrapper">
          <input
            type="password"
            id="passwordInput"
            data-translate="password"
            placeholder="Contrase√±a"
          />
          <button
            type="button"
            id="togglePassword"
            aria-label="Mostrar contrase√±a"
          >
            üëÅÔ∏è
          </button>
        </div>
        <button id="loginBtn" data-translate="loginRegister" aria-label="Registrar o iniciar sesi√≥n">
          Registrar/Iniciar Sesi√≥n
        </button>
      </div>
    </div>

    <!-- Pantalla principal -->
    <div id="mainScreen" class="screen">
      <!-- Sidebar con lista de chats -->
      <div class="sidebar">
        <div class="user-header">
          <h2 data-translate="chats">Chats</h2>
          <div class="header-actions">
            <button id="createGroup" class="icon-button" title="Crear grupo" aria-label="Crear grupo">
              <i class="fas fa-users"></i>
            </button>
            <button
              id="newChat"
              class="icon-button"
              title="Nuevo chat"
              aria-label="Nuevo chat"
              data-translate="newChat"
            >
              <i class="fa-solid fa-plus"></i>
            </button>
          </div>
        </div>
        <div class="search-container">
          <input
            type="text"
            id="searchContacts"
            data-translate="search"
            placeholder="Buscar o iniciar nuevo chat"
          />
        </div>
        <div id="chatList" class="chat-list">
          <!-- Los chats se cargar√°n aqu√≠ din√°micamente -->
        </div>

        <!-- P√°gina de Ajustes -->
        <div id="settingsPage" class="settings-page hidden">
          <div class="settings-header">
            <button class="back-button" id="backFromSettings" aria-label="Volver">
              <i class="fas fa-arrow-left"></i>
            </button>
            <h2 data-translate="settings">Ajustes</h2>
          </div>

          <div class="settings-content">
            <!-- Secci√≥n de Perfil -->
            <div class="settings-section">
              <h3 data-translate="profile">Perfil</h3>
              <div class="settings-item">
                <i class="fas fa-image"></i>
                <div class="settings-item-content">
                  <label data-translate="profileImage">Foto de perfil</label>
                  <div class="avatar-input-wrap">
                    <div id="avatarDisplay" class="avatar-placeholder"></div>
                    <img id="profileAvatar" class="avatar hidden" alt="Avatar" />
                    <input type="file" id="avatarInput" accept="image/*" class="hidden" />
                    <button
                      id="changeAvatarBtn"
                      class="icon-button settings-edit-btn"
                      aria-label="Editar"
                      title="Editar"
                    >
                      <i class="fas fa-edit"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="settings-item">
                <i class="fas fa-user"></i>
                <div class="settings-item-content">
                  <label data-translate="username">Nombre de usuario</label>
                  <div class="settings-input-wrap">
                    <input
                      type="text"
                      id="settingsUsername"
                      readonly
                      class="readonly-input"
                    />
                    <button
                      id="editUsernameBtn"
                      class="icon-button settings-edit-btn"
                      aria-label="Editar"
                      title="Editar"
                    >
                      <i class="fas fa-edit"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Secci√≥n de Idioma -->
            <div class="settings-section">
              <h3 data-translate="language">Idioma</h3>
              <div class="settings-item">
                <i class="fas fa-language"></i>
                <div class="settings-item-content">
                  <label data-translate="selectLanguage"
                    >Seleccionar idioma</label
                  >
                  <select id="languageSelectMain" class="settings-select">
                    <option value="es" data-translate="languageEs">
                      Espa√±ol
                    </option>
                    <option value="en" data-translate="languageEn">
                      Ingl√©s
                    </option>
                    <option value="it" data-translate="languageIt">
                      Italiano
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Secci√≥n de Tema -->
            <div class="settings-section">
              <h3 data-translate="theme">Tema</h3>
              <div class="settings-item">
                <i class="fas fa-palette"></i>
                <div class="settings-item-content">
                  <label data-translate="selectTheme">Seleccionar tema</label>
                  <select id="themeSelectMain" class="settings-select">
                    <option value="banderas" data-translate="themeBanderas">
                      Colores de bandera
                    </option>
                    <option value="elegante" data-translate="themeElegante">
                      Pastel elegante
                    </option>
                    <option value="creativo" data-translate="themeCreativo">
                      Creativo vibrante
                    </option>
                    <option value="elegante2" data-translate="themeElegante2">
                      Brisa de t√©
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Secci√≥n de Informaci√≥n -->
            <div class="settings-section">
              <h3 data-translate="about">Acerca de</h3>
              <div class="settings-item">
                <i class="fas fa-info-circle"></i>
                <div class="settings-item-content">
                  <span class="app-version">TraduChat v1.0</span>
                  <span class="app-developer" data-translate="developer"
                    >Desarrollado por Andrea Panepinto</span
                  >
                </div>
              </div>
            </div>

            <!-- Bot√≥n de Cerrar Sesi√≥n -->
            <div class="settings-section">
              <button id="settingsLogoutBtn" class="settings-logout-btn" aria-label="Cerrar sesi√≥n">
                <i class="fas fa-sign-out-alt"></i>
                <span data-translate="logout">Cerrar sesi√≥n</span>
              </button>
            </div>
          </div>
        </div>

        <!-- P√°gina de Grupos -->
        <div id="groupsPage" class="groups-page">
          <div class="groups-header">
            <h2 data-translate="groups">Grupos</h2>
            <div class="header-actions">
              <button
                id="createGroupFromGroups"
                class="icon-button"
                title="Crear grupo"
                aria-label="Crear grupo"
              >
                <i class="fas fa-users"></i>
              </button>
              <button
                id="newGroupChat"
                class="icon-button"
                title="Nuevo chat"
                aria-label="Nuevo chat"
                data-translate="newChat"
              >
                <i class="fa-solid fa-plus"></i>
              </button>
            </div>
          </div>
          <div id="groupsList" class="chat-list">
            <!-- Los grupos se cargar√°n aqu√≠ din√°micamente -->
          </div>
          <!-- Barra de navegaci√≥n para la p√°gina de grupos -->
          <nav class="bottom-nav">
            <button class="nav-button" id="btnChats" aria-label="Chats">
              <i class="fas fa-message"></i>
            </button>
            <button class="nav-button active" id="btnGroups" aria-label="Grupos">
              <i class="fas fa-users"></i>
            </button>
            <button class="nav-button" id="btnSettings" aria-label="Ajustes">
              <i class="fas fa-gear"></i>
            </button>
          </nav>
        </div>

        <!-- Nueva barra de navegaci√≥n -->
        <nav class="bottom-nav">
          <button class="nav-button" id="btnChats" aria-label="Chats">
            <i class="fas fa-message"></i>
          </button>
          <button class="nav-button" id="btnGroups" aria-label="Grupos">
            <i class="fas fa-users"></i>
          </button>
          <button class="nav-button" id="btnSettings" aria-label="Ajustes">
            <i class="fas fa-gear"></i>
          </button>
        </nav>
      </div>

      <!-- Contenedor del chat -->
      <div class="chat-container">
        <div class="chat-header">
          <button class="back-button" id="backToChats" aria-label="Volver a los chats">
            <span class="material-icons">arrow_back</span>
          </button>
          <div id="currentChatInfo" data-translate="selectChat">
            Selecciona un chat para comenzar
          </div>
          <button
            id="addMembersBtn"
            class="icon-button hidden"
            title="Agregar miembros"
            aria-label="Agregar miembros"
          >
            <i class="fas fa-user-plus"></i>
          </button>
        </div>
        <div id="messagesList" class="messages-list">
          <!-- Los mensajes se cargar√°n aqu√≠ din√°micamente -->
        </div>
        <div id="typingIndicator"></div>
        <div class="message-input">
          <button id="micButton" class="icon-button" title="Grabar audio" aria-label="Grabar audio">
            <i class="fas fa-microphone"></i>
          </button>
          <input
            type="text"
            id="messageInput"
            data-translate="writeMessage"
            placeholder="Escribe un mensaje..."
          />
          <button id="sendMessage" class="icon-button" aria-label="Enviar mensaje">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        browserLocalPersistence,
        setPersistence,
        initializeAuth,
        indexedDBLocalPersistence,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        initializeFirestore,
        enableIndexedDbPersistence,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import { getMessaging } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBPurWNRib5yjg-jEe3x2hBewL_Cvy132E",
        authDomain: "traduchat-2.firebaseapp.com",
        projectId: "traduchat-2",
        storageBucket: "traduchat-2.appspot.com",
        messagingSenderId: "304746474467",
        appId: "1:304746474467:web:a0496a8d1d891cec170ed6",
      };

      try {
        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);

        // Inicializar Auth con persistencia local
        const auth = initializeAuth(app, {
          persistence: [indexedDBLocalPersistence, browserLocalPersistence],
        });
        window.auth = auth;

        // Configurar Firestore
        const db = initializeFirestore(app, {
          experimentalForceLongPolling: true,
          useFetchStreams: false,
        });
        window.db = db;

        // Habilitar persistencia offline de Firestore
        enableIndexedDbPersistence(db).catch((err) => {
          if (err.code == "failed-precondition") {
            console.warn(
              "La persistencia offline fall√≥, m√∫ltiples pesta√±as abiertas"
            );
          } else if (err.code == "unimplemented") {
            console.warn("El navegador no soporta persistencia offline");
          }
        });

        // Inicializar Messaging
        try {
          const messaging = getMessaging(app);
          if (messaging) {
            window.messaging = messaging;
            console.log(
              "‚úÖ Firebase Messaging inicializado y asignado a window.messaging"
            );
          } else {
            console.warn(
              "‚ö†Ô∏è No se pudo obtener la instancia de Firebase Messaging"
            );
          }
        } catch (error) {
          console.error("‚ùå Error al inicializar Firebase Messaging:", error);
        }
      } catch (error) {
        console.error("Error al inicializar Firebase:", error);
      }
    </script>
    <div id="toastContainer" class="toast-container"></div>
    <script type="module" src="translations.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>

